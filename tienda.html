<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://kit.fontawesome.com/f740c0a1da.js" crossorigin="anonymous"></script>
    <title>AsturPadel</title>
</head>

<body>
    <div id="tapa"></div>

    <header>
        <a href="index.html"> <img class="logo" src="Images/logo.png"></a>
        <nav>
            <i class="fa-solid fa-bars"></i>

        </nav>
    </header>

    <div class="carro">

    </div>
    <main>


        <h1>OUTLET DE PADEL</h1>

        <div class="wrapper">


        </div>
    </main>

</body>


<script>

    document.querySelector(".wrapper").addEventListener("click", funciones);
    var productos = new Map();
    (async function data() {
        const datos = await fetch("js/catalogo.json");
        const catalogo = await datos.json();
        for (const item of catalogo) {
            productos.set(item.nombre, item);
        }
        return showView();
    })();

    function showView() {

        for (const [k, item] of productos) {

            let reg = "";
            let desc = "";
            let desc2 = "";
            let precioanterior = "";
            let imgreg = "";
            let romboreg = "";
            if (item.regalo != "") {
                reg = `De regalo ${item.regalo}`;
                imgreg = `<img class='regalo' src='Images/${item.regalo}.png'>`;
                romboreg = `<div class="paralelogramo">Regalo Incluido</div>`;
            }

            if (item.descuento != "") {
                desc = "descuento";
                desc2 = `- ${item.descuento}%`;
                precioanterior = "<p class='anterior'>P.V.P:<span class='anterior anterior-precio'>" + (parseFloat(item.precio.replace(",", ".")) / (1 - (item.descuento / 100))).toFixed(2).replace(".", ",") + "€</span></p>";

            }
            document.querySelector(".wrapper").innerHTML += `
        <div class="item">
            <div class="item_imagen">
            <img class="item_img" src="Images/Palas/${item.foto}">
                <div class="${desc}">${desc2}</div>
                ${imgreg}
            </div>
            <h2>${item.nombre.toUpperCase()}</h2>
            <span>${item.descripcion}</span>
            
            ${precioanterior}
            <p class="precio">${item.precio}€  </p>
            ${romboreg}
            <span>ULTIMAS <strong> ${item.unidades}</strong> uds.</span>
            <button class="${item.nombre}">Comprar</button>
            
            </div>
        `;
        }
    }

    function compra(e) {
        let carro = document.querySelector(".carro");
        let prodactu = productos.get(e.target.classList.value);
        if (prodactu.unidades <= 5) {
            e.target.previousElementSibling.firstElementChild.style.color = "red";
        }
        if (prodactu.unidades == 1) {
            e.target.previousElementSibling.innerHTML = `<img src="Images/agotado.png">`;
            e.target.remove();
        } else {
            prodactu.unidades = productos.get(e.target.classList.value).unidades - 1;
            productos.set(e.target.classList.value, prodactu);
            e.target.previousElementSibling.firstElementChild.textContent = prodactu.unidades;
        }

        let x = false;
        for (const ch of carro.children) {
            if (ch.id == prodactu.nombre) {
                x = true;
            }

        }

        if (x) {


        } else {
            carro.innerHTML += `
        <div id="${prodactu.nombre}">
            <img src="Images/Palas/${prodactu.foto}">
            <span> Precio : ${prodactu.precio}</span>
            </div>
        `;
        }
    }

    function muestra(e) {
        if (e.target.tagName == "BUTTON") {

        } else {
            let url = e.target.src;
            var tapa = document.getElementById("tapa");
            tapa.innerHTML = `<figure id="imgGrande"><figcaption>${e.target.parentElement.nextElementSibling.textContent}<i class="fa-solid fa-circle-xmark"></i></figcaption><img src=" ${url}" ></figure>`;
            document.querySelector(".fa-circle-xmark").addEventListener("click", cierra);
            tapa.style.display = "flex";
            setTimeout(() => {
                tapa.firstElementChild.style.opacity = 1;
            }, 100);
        }


    }

    function funciones(e) {
        if (e.target.tagName == "BUTTON") {
            compra(e);
        }
        if (e.target.className ==
            "item_img") {
            muestra(e);
        }
    }

    function cierra() {
        document.getElementById("tapa").style.display = "none";
    }



</script>

</html>